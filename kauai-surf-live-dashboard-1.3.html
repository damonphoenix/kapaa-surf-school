<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kaua ªi Surf Dashboard ‚Ä¢ Live ‚Ä¢ 8 Breaks</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap');
    body { font-family: 'Inter', system_ui, sans-serif; }
    .title-font { font-family: 'Space Grotesk', sans-serif; }
    .glass { background: rgba(255,255,255,0.85); backdrop-filter: blur(20px); }
    .dark .glass { background: rgba(15,23,42,0.92); }
    .wave-canvas { filter: drop-shadow(0 15px 25px rgba(34,211,238,0.35)); }
  </style>
</head>
<body class="min-h-screen bg-zinc-100 dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 pb-20">
  <!-- HEADER -->
  <header class="sticky top-0 z-50 glass border-b border-zinc-200 dark:border-zinc-800">
    <div class="max-w-screen-2xl mx-auto px-6 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-cyan-500 rounded-3xl flex items-center justify-center text-3xl">üåä</div>
        <div>
          <span class="title-font text-4xl font-bold tracking-tighter">Kaua ªi Surf</span>
          <span class="block text-xs tracking-[4px] text-zinc-500 -mt-1">LIVE ‚Ä¢ 8 BREAKS</span>
        </div>
      </div>
      <div class="flex items-center gap-8">
        <div id="live-time" class="font-mono text-lg"></div>
        <button id="theme-toggle" class="w-12 h-12 flex items-center justify-center text-3xl rounded-2xl hover:bg-zinc-200 dark:hover:bg-zinc-800">‚òÄÔ∏è</button>
        <button onclick="refreshAllData()" class="flex items-center gap-3 px-7 py-3.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-3xl font-semibold">‚ü≥ Refresh</button>
      </div>
    </div>
  </header>

  <div class="max-w-screen-2xl mx-auto px-6 pt-10">
    <!-- COLOR SCALE LEGEND -->
    <div class="flex items-center justify-center gap-6 mb-8 text-xs">
      <div class="flex items-center gap-1.5">
        <div class="w-6 h-2.5 rounded bg-red-500"></div><span>1‚Äì3 Poor</span>
      </div>
      <div class="flex items-center gap-1.5">
        <div class="w-6 h-2.5 rounded bg-orange-500"></div><span>4‚Äì5 Fair</span>
      </div>
      <div class="flex items-center gap-1.5">
        <div class="w-6 h-2.5 rounded bg-yellow-400"></div><span>6‚Äì7 Good</span>
      </div>
      <div class="flex items-center gap-1.5">
        <div class="w-6 h-2.5 rounded bg-emerald-500"></div><span>8‚Äì10 Epic</span>
      </div>
    </div>

    <!-- MAP -->
    <div class="mb-16">
      <div class="title-font text-4xl font-semibold mb-3">Live Island Map ‚Ä¢ 8 Spots</div>
      <div id="kauai-map" class="w-full h-[520px] rounded-3xl overflow-hidden shadow-2xl"></div>
    </div>

    <!-- SPOTS GRID -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6" id="spots-grid"></div>
  </div>

  <!-- DETAIL MODAL -->
  <div id="detail-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-6 bg-black/80">
    <div class="glass w-full max-w-7xl rounded-3xl max-h-[95vh] overflow-hidden flex flex-col">
      <!-- header same as before -->
      <div class="px-8 py-7 border-b flex items-center justify-between">
        <div class="flex items-center gap-6">
          <div id="modal-icon" class="text-6xl"></div>
          <div>
            <div id="modal-name" class="title-font text-4xl font-bold"></div>
            <div id="modal-facing" class="text-lg text-zinc-500"></div>
          </div>
        </div>
        <button onclick="closeModal()" class="text-5xl text-zinc-400 hover:text-white">√ó</button>
      </div>

      <div class="flex-1 overflow-auto p-8 grid grid-cols-1 lg:grid-cols-12 gap-10">
        <!-- LEFT -->
        <div class="lg:col-span-7 space-y-12">
          <!-- Current cards -->
          <div class="grid grid-cols-2 gap-4">
            <div id="modal-height-card" class="glass rounded-3xl p-8"></div>
            <div id="modal-wind-card" class="glass rounded-3xl p-8"></div>
          </div>

          <!-- Wave cross-section + bathymetry (same as last version) -->
          <div>
            <div class="text-xl font-semibold mb-4">Wave Cross-Section</div>
            <canvas id="wave-canvas" width="820" height="280" class="wave-canvas w-full"></canvas>
          </div>
          <div>
            <div class="text-xl font-semibold mb-4">Bathymetry Elevation Profile</div>
            <canvas id="bathy-canvas" width="820" height="220" class="bg-slate-950 rounded-3xl w-full"></canvas>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="lg:col-span-5 space-y-10">
          <div class="glass rounded-3xl p-9 text-center">
            <div class="uppercase text-xs tracking-widest text-zinc-500">Surf Rating</div>
            <div id="modal-rating" class="text-9xl font-black title-font tracking-tighter"></div>
            <div id="modal-rating-label" class="text-3xl font-medium"></div>
          </div>

          <!-- Insight etc. same -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // === 8 SPOTS (unchanged) ===
    const spots = [ /* ... exactly the same 8 spots as last version ... */ ];

    let map;

    function getRatingColor(r) {
      if (r >= 8) return '#10b981';
      if (r >= 6) return '#eab308';
      if (r >= 4) return '#f59e0b';
      return '#ef4444';
    }

    // Wind direction compass SVG
    function createWindCompass(windDirDeg, windKts) {
      const mph = (windKts * 1.15078).toFixed(0);
      return `
        <div class="flex flex-col items-center">
          <div class="relative w-20 h-20">
            <svg width="80" height="80" class="text-cyan-400">
              <circle cx="40" cy="40" r="36" fill="none" stroke="currentColor" stroke-width="6"/>
              <text x="40" y="18" text-anchor="middle" fill="currentColor" font-size="11" font-weight="700">N</text>
              <polygon points="35,12 40,4 45,12" fill="currentColor" transform="rotate(${windDirDeg} 40 40)"/>
            </svg>
          </div>
          <div class="text-4xl font-bold text-cyan-400 -mt-2">${windDirDeg}¬∞</div>
          <div class="text-sm text-zinc-400">from</div>
        </div>
        <div class="text-center">
          <div class="text-5xl font-semibold">${windKts}<span class="text-base align-super ml-1">kt</span></div>
          <div class="text-xl text-zinc-400">${mph} mph</div>
        </div>
      `;
    }

    async function openModal(id) {
      // CLOSE ANY OPEN MAP POPUP FIRST
      if (map) map.closePopup();

      const entry = allSpotData.find(e => e.spot.id === id);
      if (!entry || !entry.data) return;

      const {spot, data, ratingInfo} = entry;
      const modal = document.getElementById("detail-modal");
      modal.classList.remove("hidden");
      modal.classList.add("flex");

      // ... fill name, facing, height card, wave canvas, bathy etc. (same as before) ...

      // WIND CARD ‚Äî NEW STYLE
      const windKts = (data.windSpeed * 1.94384).toFixed(0);
      const windDir = Math.round(data.windDirection || 0);
      const windHTML = `
        <div class="text-xs text-zinc-400 mb-3">WIND</div>
        <div class="flex items-center justify-center gap-10">
          ${createWindCompass(windDir, windKts)}
        </div>
      `;
      document.getElementById("modal-wind-card").innerHTML = windHTML;

      // Rating with color scale
      const r = ratingInfo.total;
      const color = getRatingColor(r);
      document.getElementById("modal-rating").style.color = color;
      document.getElementById("modal-rating").textContent = r;
      // ... rest of modal same ...
    }

    function initMap() {
      map = L.map('kauai-map', {
        minZoom: 9.5,
        maxZoom: 15,
        maxBounds: L.latLngBounds(
          L.latLng(21.65, -160.0),   // SW corner
          L.latLng(22.45, -159.0)    // NE corner
        ),
        maxBoundsViscosity: 1.0
      }).setView([22.05, -159.5], 10.8);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

      spots.forEach(s => {
        L.circleMarker([s.lat, s.lon], {
          radius: 11,
          fillColor: s.color,
          color: '#fff',
          weight: 3,
          fillOpacity: 0.95
        })
        .addTo(map)
        .bindPopup(`<b>${s.name}</b><br>${s.facing} facing`)
        .on('click', () => openModal(s.id));
      });
    }

    // renderCard now uses color scale
    function renderCard(spot, data, ratingInfo) {
      const color = getRatingColor(ratingInfo.total);
      // ... card HTML with style="color:${color}" on the big rating number ...
    }

    // Rest of the code (fetch, renderAllCards, wave canvas, bathy canvas, theme toggle, etc.) remains exactly the same as the previous flawless version.

    window.onload = () => {
      initMap();
      renderAllCards();
      // ... live time, theme, etc.
    };
  </script>
</body>
</html>